export default defineEventHandler(async event => {
  const config = useRuntimeConfig()
  const { symbol } = getQuery(event)

  if (!symbol) {
    throw createError({
      statusCode: 400,
      statusMessage: 'Symbol is required'
    })
  }

  // const realResult = await $fetch(`/api/v3/historical-price-full/${symbol}`, {
  //   baseURL: `https://financialmodelingprep.com`,
  //   params: {
  //     timeseries: 30,
  //     apikey: config.FMP_API_KEY
  //   }
  // })

  const testResult = {
    "symbol": "AAPL",
    "historical": [
      {
        "date": "2025-08-15",
        "open": 234,
        "high": 234.28,
        "low": 229.34,
        "close": 231.59,
        "adjClose": 231.59,
        "volume": 56038657,
        "unadjustedVolume": 56038657,
        "change": -2.41,
        "changePercent": -1.03,
        "vwap": 232.3025,
        "label": "August 15, 25",
        "changeOverTime": -0.0103
      },
      {
        "date": "2025-08-14",
        "open": 234.06,
        "high": 235.12,
        "low": 230.85,
        "close": 232.78,
        "adjClose": 232.78,
        "volume": 51916300,
        "unadjustedVolume": 51916300,
        "change": -1.28,
        "changePercent": -0.54687,
        "vwap": 233.2025,
        "label": "August 14, 25",
        "changeOverTime": -0.0054687
      },
      {
        "date": "2025-08-13",
        "open": 231.07,
        "high": 235,
        "low": 230.43,
        "close": 233.33,
        "adjClose": 233.33,
        "volume": 69878546,
        "unadjustedVolume": 69878546,
        "change": 2.26,
        "changePercent": 0.97806,
        "vwap": 232.4575,
        "label": "August 13, 25",
        "changeOverTime": 0.0097806
      },
      {
        "date": "2025-08-12",
        "open": 228.01,
        "high": 230.8,
        "low": 227.07,
        "close": 229.65,
        "adjClose": 229.65,
        "volume": 55672301,
        "unadjustedVolume": 55672301,
        "change": 1.65,
        "changePercent": 0.71927,
        "vwap": 228.8825,
        "label": "August 12, 25",
        "changeOverTime": 0.0071927
      },
      {
        "date": "2025-08-11",
        "open": 227.92,
        "high": 229.56,
        "low": 224.76,
        "close": 227.18,
        "adjClose": 227.18,
        "volume": 61806132,
        "unadjustedVolume": 61806132,
        "change": -0.74,
        "changePercent": -0.32468,
        "vwap": 227.355,
        "label": "August 11, 25",
        "changeOverTime": -0.0032468
      },
      {
        "date": "2025-08-08",
        "open": 220.83,
        "high": 231,
        "low": 219.25,
        "close": 229.35,
        "adjClose": 229.09,
        "volume": 113854000,
        "unadjustedVolume": 113854000,
        "change": 8.52,
        "changePercent": 3.86,
        "vwap": 225.1075,
        "label": "August 08, 25",
        "changeOverTime": 0.0386
      },
      {
        "date": "2025-08-07",
        "open": 218.88,
        "high": 220.85,
        "low": 216.58,
        "close": 220.03,
        "adjClose": 219.78,
        "volume": 90224834,
        "unadjustedVolume": 90224834,
        "change": 1.16,
        "changePercent": 0.5254,
        "vwap": 219.085,
        "label": "August 07, 25",
        "changeOverTime": 0.005254
      },
      {
        "date": "2025-08-06",
        "open": 205.63,
        "high": 215.38,
        "low": 205.59,
        "close": 213.25,
        "adjClose": 213.01,
        "volume": 108483103,
        "unadjustedVolume": 108483103,
        "change": 7.62,
        "changePercent": 3.71,
        "vwap": 209.9625,
        "label": "August 06, 25",
        "changeOverTime": 0.0371
      },
      {
        "date": "2025-08-05",
        "open": 203.4,
        "high": 205.34,
        "low": 202.16,
        "close": 202.92,
        "adjClose": 202.69,
        "volume": 44155100,
        "unadjustedVolume": 44155100,
        "change": -0.48,
        "changePercent": -0.23599,
        "vwap": 203.455,
        "label": "August 05, 25",
        "changeOverTime": -0.0023599
      },
      {
        "date": "2025-08-04",
        "open": 204.51,
        "high": 207.88,
        "low": 201.68,
        "close": 203.35,
        "adjClose": 203.12,
        "volume": 75109300,
        "unadjustedVolume": 75109300,
        "change": -1.16,
        "changePercent": -0.56721,
        "vwap": 204.355,
        "label": "August 04, 25",
        "changeOverTime": -0.0056721
      },
      {
        "date": "2025-08-01",
        "open": 210.87,
        "high": 213.58,
        "low": 201.5,
        "close": 202.38,
        "adjClose": 202.15,
        "volume": 104434500,
        "unadjustedVolume": 104434500,
        "change": -8.49,
        "changePercent": -4.03,
        "vwap": 207.0825,
        "label": "August 01, 25",
        "changeOverTime": -0.0403
      },
      {
        "date": "2025-07-31",
        "open": 208.49,
        "high": 209.84,
        "low": 207.16,
        "close": 207.57,
        "adjClose": 207.33,
        "volume": 80698431,
        "unadjustedVolume": 80698431,
        "change": -0.92,
        "changePercent": -0.44127,
        "vwap": 208.265,
        "label": "July 31, 25",
        "changeOverTime": -0.0044127
      },
      {
        "date": "2025-07-30",
        "open": 211.9,
        "high": 212.39,
        "low": 207.72,
        "close": 209.05,
        "adjClose": 208.81,
        "volume": 45512514,
        "unadjustedVolume": 45512514,
        "change": -2.84,
        "changePercent": -1.34,
        "vwap": 210.265,
        "label": "July 30, 25",
        "changeOverTime": -0.0134
      },
      {
        "date": "2025-07-29",
        "open": 214.18,
        "high": 214.81,
        "low": 210.82,
        "close": 211.27,
        "adjClose": 211.03,
        "volume": 51411723,
        "unadjustedVolume": 51411723,
        "change": -2.91,
        "changePercent": -1.36,
        "vwap": 212.77,
        "label": "July 29, 25",
        "changeOverTime": -0.0136
      },
      {
        "date": "2025-07-28",
        "open": 214.03,
        "high": 214.85,
        "low": 213.06,
        "close": 214.05,
        "adjClose": 213.81,
        "volume": 37858017,
        "unadjustedVolume": 37858017,
        "change": 0.02,
        "changePercent": 0.00934448,
        "vwap": 213.9975,
        "label": "July 28, 25",
        "changeOverTime": 0.0000934448
      },
      {
        "date": "2025-07-25",
        "open": 214.7,
        "high": 215.24,
        "low": 213.4,
        "close": 213.88,
        "adjClose": 213.64,
        "volume": 40268800,
        "unadjustedVolume": 40268800,
        "change": -0.82,
        "changePercent": -0.38193,
        "vwap": 214.305,
        "label": "July 25, 25",
        "changeOverTime": -0.0038193
      },
      {
        "date": "2025-07-24",
        "open": 213.9,
        "high": 215.69,
        "low": 213.53,
        "close": 213.76,
        "adjClose": 213.52,
        "volume": 46022620,
        "unadjustedVolume": 46022620,
        "change": -0.14,
        "changePercent": -0.06545115,
        "vwap": 214.22,
        "label": "July 24, 25",
        "changeOverTime": -0.0006545115
      },
      {
        "date": "2025-07-23",
        "open": 215,
        "high": 215.15,
        "low": 212.41,
        "close": 214.15,
        "adjClose": 213.91,
        "volume": 46989301,
        "unadjustedVolume": 46989301,
        "change": -0.85,
        "changePercent": -0.39535,
        "vwap": 214.1775,
        "label": "July 23, 25",
        "changeOverTime": -0.0039535
      },
      {
        "date": "2025-07-22",
        "open": 213.14,
        "high": 214.95,
        "low": 212.23,
        "close": 214.4,
        "adjClose": 214.16,
        "volume": 46404100,
        "unadjustedVolume": 46404100,
        "change": 1.26,
        "changePercent": 0.59116,
        "vwap": 213.68,
        "label": "July 22, 25",
        "changeOverTime": 0.0059116
      },
      {
        "date": "2025-07-21",
        "open": 212.1,
        "high": 215.78,
        "low": 211.63,
        "close": 212.48,
        "adjClose": 212.24,
        "volume": 51377434,
        "unadjustedVolume": 51377434,
        "change": 0.38,
        "changePercent": 0.17916,
        "vwap": 212.9975,
        "label": "July 21, 25",
        "changeOverTime": 0.0017916
      },
      {
        "date": "2025-07-18",
        "open": 210.87,
        "high": 211.79,
        "low": 209.7,
        "close": 211.18,
        "adjClose": 210.94,
        "volume": 48974600,
        "unadjustedVolume": 48974600,
        "change": 0.31,
        "changePercent": 0.14701,
        "vwap": 210.885,
        "label": "July 18, 25",
        "changeOverTime": 0.0014701
      },
      {
        "date": "2025-07-17",
        "open": 210.57,
        "high": 211.8,
        "low": 209.59,
        "close": 210.02,
        "adjClose": 209.78,
        "volume": 48068141,
        "unadjustedVolume": 48068141,
        "change": -0.55,
        "changePercent": -0.2612,
        "vwap": 210.495,
        "label": "July 17, 25",
        "changeOverTime": -0.002612
      },
      {
        "date": "2025-07-16",
        "open": 210.3,
        "high": 212.4,
        "low": 208.64,
        "close": 210.16,
        "adjClose": 209.92,
        "volume": 47490532,
        "unadjustedVolume": 47490532,
        "change": -0.135,
        "changePercent": -0.06657156,
        "vwap": 210.375,
        "label": "July 16, 25",
        "changeOverTime": -0.0006657156
      },
      {
        "date": "2025-07-15",
        "open": 209.22,
        "high": 211.89,
        "low": 208.92,
        "close": 209.11,
        "adjClose": 208.87,
        "volume": 42296339,
        "unadjustedVolume": 42296339,
        "change": -0.11,
        "changePercent": -0.05257624,
        "vwap": 209.785,
        "label": "July 15, 25",
        "changeOverTime": -0.0005257624
      },
      {
        "date": "2025-07-14",
        "open": 209.93,
        "high": 210.91,
        "low": 207.54,
        "close": 208.62,
        "adjClose": 208.38,
        "volume": 38840111,
        "unadjustedVolume": 38840111,
        "change": -1.31,
        "changePercent": -0.62402,
        "vwap": 209.25,
        "label": "July 14, 25",
        "changeOverTime": -0.0062402
      },
      {
        "date": "2025-07-11",
        "open": 210.57,
        "high": 212.13,
        "low": 209.86,
        "close": 211.16,
        "adjClose": 210.92,
        "volume": 39765812,
        "unadjustedVolume": 39765812,
        "change": 0.595,
        "changePercent": 0.28019,
        "vwap": 210.93,
        "label": "July 11, 25",
        "changeOverTime": 0.0028019
      },
      {
        "date": "2025-07-10",
        "open": 210.51,
        "high": 213.48,
        "low": 210.03,
        "close": 212.41,
        "adjClose": 212.17,
        "volume": 44443635,
        "unadjustedVolume": 44443635,
        "change": 1.91,
        "changePercent": 0.90257,
        "vwap": 211.6075,
        "label": "July 10, 25",
        "changeOverTime": 0.0090257
      },
      {
        "date": "2025-07-09",
        "open": 209.53,
        "high": 211.33,
        "low": 207.22,
        "close": 211.14,
        "adjClose": 210.9,
        "volume": 48749400,
        "unadjustedVolume": 48749400,
        "change": 1.61,
        "changePercent": 0.76839,
        "vwap": 209.805,
        "label": "July 09, 25",
        "changeOverTime": 0.0076839
      },
      {
        "date": "2025-07-08",
        "open": 210.1,
        "high": 211.43,
        "low": 208.45,
        "close": 210.01,
        "adjClose": 209.77,
        "volume": 42848928,
        "unadjustedVolume": 42848928,
        "change": -0.09,
        "changePercent": -0.04283674,
        "vwap": 209.9975,
        "label": "July 08, 25",
        "changeOverTime": -0.0004283674
      },
      {
        "date": "2025-07-07",
        "open": 212.68,
        "high": 216.23,
        "low": 208.8,
        "close": 209.95,
        "adjClose": 209.71,
        "volume": 50229000,
        "unadjustedVolume": 50229000,
        "change": -2.73,
        "changePercent": -1.28,
        "vwap": 211.915,
        "label": "July 07, 25",
        "changeOverTime": -0.0128
      }
    ]
  }

  return testResult
})
